- alias: ColemanInBed
  trigger:
    platform: state
    entity_id: binary_sensor.sleepnumber_m7_coleman_is_in_bed
    to: 'on'
  action:
    service: notify.mypushbullet
    data_template:
      title: "Coleman Bed Sensor"
      message: "Coleman in bed"

- alias: ColemanOutBed
  trigger:
    platform: state
    entity_id: binary_sensor.sleepnumber_m7_coleman_is_in_bed
    to: 'off'
  action:
    service: notify.mypushbullet
    data_template:
      title: "Coleman Bed Sensor"
      message: "Coleman out of bed"


#--------------------------------------------------

# LIGHTING

- alias: Kitchen Sensor Daytime
  trigger:
    platform: state
    entity_id: sensor.kitchen_motion_sensor
    to: 'on'
  condition:
#between day hours (6:15am-7pm)
    - condition: time
      after: '06:15:00'
      before: '19:00:00'  
  action:
    - service: homeassistant.turn_on
      data:
        entity_id: light.kitchen
        brightness: 255

#kitchen sensor when no one is in bed
- alias: Kitchen Sensor evening
  trigger:
    platform: state
    entity_id: sensor.kitchen_motion_sensor
    to: 'on'
  condition:
    condition: and
    conditions:
# if between evening hours (7pm-11pm) and no one is in bed (if someone in bed, it goes to nightlight mode)
      - condition: time
        after: '19:00:0'
        before: '23:00:00'
      - condition: state
        entity_id: binary_sensor.sleepnumber_m7_coleman_is_in_bed
        state: 'off'
      - condition: state
        entity_id: binary_sensor.sleepnumber_m7_liz_is_in_bed
        state: 'off'  
  action:
    - service: homeassistant.turn_on
      data:
        entity_id: light.kitchen
        brightness: 200


- alias: Kitchen Sensor Nightlight
  trigger:
    platform: state
    entity_id: sensor.kitchen_motion_sensor
    to: 'on'
  condition:
# if between evening hours (7pm-11pm) and anyone is in bed, OR if night (11pm-6:15am)  
    condition: or
    conditions:
      - condition: time
        after: '23:00:00'
        before: '06:30:00'
      - condition: and
        conditions:
          - condition: time
            after: '19:00:00'
            before: '23:00:00'
          - condition: or
            conditions:
            - condition: state
              entity_id: binary_sensor.sleepnumber_m7_coleman_is_in_bed
              state: 'on'
            - condition: state
              entity_id: binary_sensor.sleepnumber_m7_liz_is_in_bed
              state: 'on' 
  action:
    - service: homeassistant.turn_on
      data:
        entity_id: light.kitchen
        brightness: 30


- alias: Kitchen Light Sensor Auto-Off
  trigger:
    platform: state
    entity_id: sensor.kitchen_motion_sensor
    to: 'off'
    for:
      minutes: 1
  action:
    service: homeassistant.turn_off
    entity_id: light.kitchen
    data: 
      transition: 5

# You can also restrict lights from turning on based on 
#   time of day and implement transitions for 
#   fading lights on and off.


# Here is Bedroom Lights: 
#    Turn on with Hue sensor bright unless either person in bed

# Bed Daytime - full bright with motion
#    Turn on lights full bright between 7am and 11 pm
#    and if bed is empty
- alias: Bedroom Sensor Day Time
  trigger:
    platform: state
    entity_id: sensor.bedroom_motion_sensor
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '06:30:00'
        before: '23:00:00'
      - condition: state
        entity_id: binary_sensor.sleepnumber_m7_coleman_is_in_bed
        state: 'off'
      - condition: state
        entity_id: binary_sensor.sleepnumber_m7_liz_is_in_bed
        state: 'off'
  action:
    - service: homeassistant.turn_on
      data:
        entity_id: light.bedroom
        brightness: 255

# Bed Nighttime - underbed dim with motion
#    Turn on lights full bright between 9pm and 6:30 am
#    and if at least 1 person in bed
#    and if bed lights were off
- alias: Bedroom Sensor Day Time
  trigger:
    platform: state
    entity_id: sensor.bedroom_motion_sensor
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '21:00:00'
        before: '06:30:00'
      - condition: state
        entity_id: light.under_bed_lightstrip
        state: 'off'
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.sleepnumber_m7_coleman_is_in_bed
          state: 'on'
        - condition: state
          entity_id: binary_sensor.sleepnumber_m7_liz_is_in_bed
          state: 'on'
  action:
    - service: homeassistant.turn_on
      data:
        entity_id: light.under_bed_lightstrip
        rgb_color: [255,0,0]
        brightness: 5

- alias: Bedroom light OFF 1 minutes after last movement if bed empty
  trigger:
    platform: state
    entity_id: sensor.bedroom_motion_sensor
    to: 'off'
    for:
      minutes: 1
  condition:
    condition: and
    conditions:
      - condition: time
        after: '06:30:00'
        before: '23:00:00'
      - condition: state
        entity_id: binary_sensor.sleepnumber_m7_coleman_is_in_bed
        state: 'off'
      - condition: state
        entity_id: binary_sensor.sleepnumber_m7_liz_is_in_bed
        state: 'off'
  action:
    service: homeassistant.turn_off
    entity_id: light.bedroom
    data: 
      transition: 4


# slider automation of kitchen
- alias: Brightness Kitchen
  trigger:
    platform: state
    entity_id: input_number.brightness_kitchen
  action:
    service: light.turn_on
    data:
      entity_id:
        - light.kitchen
    data_template:
      brightness: '{{ states( "input_number.brightness_kitchen" )|round( 0 ) }}'

# slider automation of bedroom
- alias: Brightness Bedroom
  trigger:
    platform: state
    entity_id: input_number.brightness_bedroom
  action:
    service: light.turn_on
    data:
      entity_id:
        - light.bedroom
    data_template:
      brightness: '{{ states( "input_number.brightness_bedroom" )|round( 0 ) }}'